<html>
<head>
<title>mfcc.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
mfcc.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">math</span>
<span class="s0">import </span><span class="s1">wave</span>
<span class="s0">import </span><span class="s1">time</span>
<span class="s0">import </span><span class="s1">csv</span>

<span class="s2">#start time for block 1</span>
<span class="s1">st1 = time.time()</span>


<span class="s1">sample_rate = </span><span class="s3">44100</span>

<span class="s0">with </span><span class="s1">wave.open(</span><span class="s4">&quot;download.wav&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">w:</span>
    <span class="s1">print(w.getframerate())</span>
    <span class="s1">print(w.getsampwidth())</span>
    <span class="s1">print(w.getnchannels())</span>
    <span class="s1">print(list(memoryview(w.readframes(</span><span class="s3">100</span><span class="s1">)).cast(</span><span class="s4">&quot;h&quot;</span><span class="s1">)))</span>

    <span class="s2"># Get the audio file parameters</span>
    <span class="s1">sample_width = w.getsampwidth()</span>
    <span class="s1">num_frames = w.getnframes()</span>

    <span class="s2"># Read all frames from the WAV file</span>
    <span class="s1">audio_data = w.readframes(num_frames)</span>

<span class="s1">audio_data_int = []</span>
<span class="s1">sample_rate = </span><span class="s3">44100</span>

<span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">len(audio_data)</span><span class="s0">, </span><span class="s1">sample_width):</span>
    <span class="s2"># Convert bytes to integer value</span>
    <span class="s1">value = </span><span class="s3">0</span>
    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(sample_width):</span>
        <span class="s1">value |= audio_data[i + j] &lt;&lt; (</span><span class="s3">8 </span><span class="s1">* j)</span>

    <span class="s2"># Handle negative values</span>
    <span class="s0">if </span><span class="s1">value &gt;= (</span><span class="s3">1 </span><span class="s1">&lt;&lt; (</span><span class="s3">8 </span><span class="s1">* sample_width - </span><span class="s3">1</span><span class="s1">)):</span>
        <span class="s1">value -= </span><span class="s3">1 </span><span class="s1">&lt;&lt; (</span><span class="s3">8 </span><span class="s1">* sample_width)</span>

    <span class="s1">audio_data_int.append(value)</span>

<span class="s0">def </span><span class="s1">max_abs_value(lst):</span>
    <span class="s1">max_abs = </span><span class="s0">None</span>
    <span class="s0">for </span><span class="s1">num </span><span class="s0">in </span><span class="s1">lst:</span>
        <span class="s1">abs_val = abs(num)</span>
        <span class="s0">if </span><span class="s1">max_abs </span><span class="s0">is None or </span><span class="s1">abs_val &gt; max_abs:</span>
            <span class="s1">max_abs = abs_val</span>
    <span class="s0">return </span><span class="s1">max_abs</span>

<span class="s0">def </span><span class="s1">divide_list(lst</span><span class="s0">, </span><span class="s1">divisor):</span>
    <span class="s1">result = []</span>
    <span class="s0">for </span><span class="s1">num </span><span class="s0">in </span><span class="s1">lst:</span>
        <span class="s1">result.append(num / divisor)</span>
    <span class="s0">return </span><span class="s1">result</span>


<span class="s1">result = max_abs_value(audio_data_int)</span>
<span class="s1">audio_data = divide_list(audio_data_int</span><span class="s0">, </span><span class="s1">result)</span>


<span class="s2"># Set up the MFCC parameters</span>
<span class="s1">duration = len(audio_data) / sample_rate</span>
<span class="s1">num_samples = len(audio_data)</span>
<span class="s1">num_mfccs = </span><span class="s3">13</span>
<span class="s1">num_filters = </span><span class="s3">26</span>
<span class="s1">filter_bank = []</span>
<span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(num_filters):</span>
    <span class="s1">filter_bank.append([])</span>

<span class="s2">#end time for block 1</span>
<span class="s1">et1 = time.time()</span>

<span class="s2">#start time for block 2</span>
<span class="s1">st2 = time.time()</span>

<span class="s2"># Compute the filter bank</span>
<span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(num_filters):</span>
    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(sample_rate // </span><span class="s3">2</span><span class="s1">):</span>
        <span class="s1">freq = j / sample_rate</span>
        <span class="s0">if </span><span class="s1">freq &gt;= (i * </span><span class="s3">1000 </span><span class="s1">/ </span><span class="s3">700</span><span class="s1">) </span><span class="s0">and </span><span class="s1">freq &lt;= ((i + </span><span class="s3">2</span><span class="s1">) * </span><span class="s3">1000 </span><span class="s1">/ </span><span class="s3">700</span><span class="s1">):</span>
            <span class="s1">filter_bank[i].append((freq - i * </span><span class="s3">1000 </span><span class="s1">/ </span><span class="s3">700</span><span class="s1">) / (</span><span class="s3">1000 </span><span class="s1">/ </span><span class="s3">700</span><span class="s1">))</span>
        <span class="s0">elif </span><span class="s1">freq &gt;= ((i + </span><span class="s3">1</span><span class="s1">) * </span><span class="s3">1000 </span><span class="s1">/ </span><span class="s3">700</span><span class="s1">) </span><span class="s0">and </span><span class="s1">freq &lt;= ((i + </span><span class="s3">3</span><span class="s1">) * </span><span class="s3">1000 </span><span class="s1">/ </span><span class="s3">700</span><span class="s1">):</span>
            <span class="s1">filter_bank[i].append(((i + </span><span class="s3">3</span><span class="s1">) * </span><span class="s3">1000 </span><span class="s1">/ </span><span class="s3">700 </span><span class="s1">- freq) / (</span><span class="s3">1000 </span><span class="s1">/ </span><span class="s3">700</span><span class="s1">))</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">filter_bank[i].append(</span><span class="s3">0</span><span class="s1">)</span>

<span class="s2">#end time for block 2</span>
<span class="s1">et2 = time.time()</span>

<span class="s2">#get the start time for block 3</span>
<span class="s1">st3 = time.time()</span>

<span class="s2"># Compute the MFCCs</span>
<span class="s1">mfccs = []</span>

<span class="s1">num_chunks = num_samples // num_samples</span>
<span class="s0">for </span><span class="s1">chunk_idx </span><span class="s0">in </span><span class="s1">range(num_chunks):</span>
    <span class="s2"># Extract a chunk of audio data</span>
    <span class="s1">start_idx = chunk_idx * </span><span class="s3">512</span>
    <span class="s1">end_idx = min((chunk_idx + </span><span class="s3">1</span><span class="s1">) * </span><span class="s3">512</span><span class="s0">, </span><span class="s1">num_samples)</span>
    <span class="s1">audio_chunk = audio_data[start_idx:end_idx]</span>

    <span class="s2"># Compute the power spectrum</span>
    <span class="s1">power_spectrum = [</span><span class="s3">0</span><span class="s1">] * len(audio_chunk)</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(len(audio_chunk)):</span>
        <span class="s1">power_spectrum[i] = abs(audio_chunk[i]) ** </span><span class="s3">2</span>

    <span class="s2">#end time for block 3</span>
    <span class="s1">et3 = time.time()</span>

    <span class="s2">#start time for block 4</span>
    <span class="s1">st4 = time.time()</span>

    <span class="s2"># Apply the filter bank</span>
    <span class="s1">filter_bank_energies = [</span><span class="s3">0</span><span class="s1">] * num_filters</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(num_filters):</span>
        <span class="s1">filter_energy = </span><span class="s3">0</span>
        <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(len(filter_bank[i])):</span>
            <span class="s0">if </span><span class="s1">j &lt; len(power_spectrum):</span>
                <span class="s1">filter_energy += filter_bank[i][j] * power_spectrum[j]</span>
        <span class="s1">filter_bank_energies[i] = math.log(filter_energy + </span><span class="s3">1e-6</span><span class="s1">)</span>

    <span class="s2">#end time for block 4</span>
    <span class="s1">et4 = time.time()</span>

    <span class="s2">#start time for block 5</span>
    <span class="s1">st5 = time.time()</span>

    <span class="s2"># Compute the MFCCs</span>
    <span class="s1">mfccs_chunk = [</span><span class="s3">0</span><span class="s1">] * num_mfccs</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(num_mfccs):</span>
        <span class="s1">mfcc_val = </span><span class="s3">0</span>
        <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(num_filters):</span>
            <span class="s1">mfcc_val += filter_bank_energies[j] * math.cos(math.pi * i / num_filters * (j + </span><span class="s3">0.5</span><span class="s1">))</span>
        <span class="s1">mfccs_chunk[i] = mfcc_val</span>
    <span class="s1">mfccs.append(mfccs_chunk)</span>

<span class="s2"># Print the MFCCs and their mean</span>
<span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(len(mfccs)):</span>
    <span class="s1">print(</span><span class="s4">&quot;MFCCs for chunk&quot;</span><span class="s0">, </span><span class="s1">i</span><span class="s0">, </span><span class="s4">&quot;:&quot;</span><span class="s0">, </span><span class="s1">mfccs[i])</span>

    <span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range(len(mfccs[i])):</span>
        <span class="s1">t = mfccs[i][y]</span>
    <span class="s1">print(type(t))</span>

<span class="s1">mfccs_mean = [</span><span class="s3">0</span><span class="s1">] * num_mfccs</span>
<span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(num_mfccs):</span>
    <span class="s1">mfccs_mean[i] = sum([mfccs[j][i] </span><span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(len(mfccs))]) / len(mfccs)</span>

<span class="s2">#end time for block 5</span>
<span class="s1">et5 = time.time()</span>

<span class="s1">print(</span><span class="s4">&quot;MFCCs mean:&quot;</span><span class="s0">, </span><span class="s1">mfccs_mean)</span>

<span class="s2"># get the execution time</span>
<span class="s1">elapsed_time1 = et1 - st1</span>
<span class="s1">print(</span><span class="s4">'Execution time (framing and windowing):'</span><span class="s0">, </span><span class="s1">elapsed_time1</span><span class="s0">, </span><span class="s4">'seconds'</span><span class="s1">)</span>

<span class="s2"># get the execution time</span>
<span class="s1">elapsed_time2 = et2 - st2</span>
<span class="s1">print(</span><span class="s4">'Execution time (windowing and fft):'</span><span class="s0">, </span><span class="s1">elapsed_time2</span><span class="s0">, </span><span class="s4">'seconds'</span><span class="s1">)</span>

<span class="s2"># get the execution time</span>
<span class="s1">elapsed_time3 = et3 - st3</span>
<span class="s1">print(</span><span class="s4">'Execution time (mel-filter bank):'</span><span class="s0">, </span><span class="s1">elapsed_time3</span><span class="s0">, </span><span class="s4">'seconds'</span><span class="s1">)</span>

<span class="s2"># get the execution time</span>
<span class="s1">elapsed_time4 = et4 - st4</span>
<span class="s1">print(</span><span class="s4">'Execution time (DCT):'</span><span class="s0">, </span><span class="s1">elapsed_time4</span><span class="s0">, </span><span class="s4">'seconds'</span><span class="s1">)</span>

<span class="s2"># get the execution time</span>
<span class="s1">elapsed_time5 = et5 - st5</span>
<span class="s1">print(</span><span class="s4">'Execution time (cepstral coefficient):'</span><span class="s0">, </span><span class="s1">elapsed_time5</span><span class="s0">, </span><span class="s4">'seconds'</span><span class="s1">)</span>

<span class="s2">#sum</span>
<span class="s1">time = elapsed_time5 + elapsed_time4 + elapsed_time3 + elapsed_time2 + elapsed_time1</span>
<span class="s1">print(</span><span class="s4">'Execution time(sum) :'</span><span class="s0">, </span><span class="s1">time</span><span class="s0">, </span><span class="s4">'seconds'</span><span class="s1">)</span>

<span class="s2"># overall execution time</span>
<span class="s1">elapsed_time = et5 - st1</span>
<span class="s1">print(</span><span class="s4">'Execution time:'</span><span class="s0">, </span><span class="s1">elapsed_time</span><span class="s0">, </span><span class="s4">'seconds'</span><span class="s1">)</span>

<span class="s0">def </span><span class="s1">save_mfccs_to_csv(mfccs</span><span class="s0">, </span><span class="s1">filename):</span>
    <span class="s0">with </span><span class="s1">open(filename</span><span class="s0">, </span><span class="s4">&quot;w&quot;</span><span class="s0">, </span><span class="s1">newline=</span><span class="s4">&quot;&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">csvfile:</span>
        <span class="s1">writer = csv.writer(csvfile</span><span class="s0">, </span><span class="s1">delimiter=</span><span class="s4">&quot;,&quot;</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">chunk_mfccs </span><span class="s0">in </span><span class="s1">mfccs:</span>
            <span class="s1">writer.writerow(chunk_mfccs)</span>

<span class="s0">if </span><span class="s1">__name__ == </span><span class="s4">&quot;__main__&quot;</span><span class="s1">:</span>
    <span class="s1">mfccs = []</span>
    <span class="s0">for </span><span class="s1">chunk_idx </span><span class="s0">in </span><span class="s1">range(num_chunks):</span>
        <span class="s1">chunk_mfccs = []</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(num_mfccs):</span>
            <span class="s1">chunk_mfccs.append(mfccs_chunk[i])</span>
        <span class="s1">mfccs.append(chunk_mfccs)</span>

    <span class="s1">save_mfccs_to_csv(mfccs</span><span class="s0">, </span><span class="s4">&quot;mfccs.csv&quot;</span><span class="s1">)</span></pre>
</body>
</html>